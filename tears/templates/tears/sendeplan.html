{% extends "tears/base.html" %}
{% load wagtailcore_tags wagtailimages_tags %}
{% load static %}
{% load dict_extras %}
{% block content %}

<head>
    <link rel="stylesheet" href="{% static 'tears/css/sendeplan.css' %}?v={% now 'U' %}">


    <script src="https://cdn.tailwindcss.com"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        /* Custom scrollbar styling */
        .schedule-container::-webkit-scrollbar {
            height: 8px;
        }

        .schedule-container::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        .schedule-container::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        .schedule-container::-webkit-scrollbar-thumb:hover {
            background: #555;
        }

        /* Ensure text doesn't wrap in cells */
        .schedule-cell {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            vertical-align: top;
            text-align: center;
            padding: 2px;
            font-size: 11px;
            line-height: 1.2;
            height: 32px;
        }

        /* Time column styling */
        .time-cell {
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 500;
        }

        /* Program blocks that span multiple rows */
        .program-1-row {
            height: 32px;
        }

        .program-2-rows {
            height: 64px;
        }

        .program-3-rows {
            height: 96px;
        }

        .program-4-rows {
            height: 128px;
        }

        /* Sync scrolling */
        .time-table,
        .schedule-table {
            display: inline-block;
            vertical-align: top;
        }

        .schedule-container table {
            table-layout: fixed;
            width: 100%;
        }
    </style>
</head>

<body>


    <header class="w-full bg-[#f7f4f4] p-10 mb-8">
        <div class="max-w-6xl mx-auto px-200">
            <!-- Breadcrumb Navigation -->
            <div class="text-sm text-gray-500 mb-4 mt-1">
                {% if self.get_ancestors|length > 1 %}
                <nav aria-label="Breadcrumb">
                    <ul class="flex items-center space-x-2 flex-wrap">
                        {% for p in self.get_ancestors %}
                        {% if not p.is_root %}
                        <li
                            class="flex items-center {% if forloop.counter > 1 and forloop.counter < forloop.parentloop.counter0|add:'-1' %}hidden sm:flex{% endif %}">
                            <a href="{{ p.url }}" class="hover:text-red-600 transition-colors">{{ p.title }}</a>
                            <span class="mx-2 text-gray-400">→</span>
                        </li>
                        {% endif %}
                        {% endfor %}
                        <!-- Show ellipsis on small screens if there are hidden items -->
                        {% if self.get_ancestors|length > 3 %}
                        <li class="sm:hidden flex items-center">
                            <span class="text-gray-400">...</span>
                            <span class="mx-2 text-gray-400">→</span>
                        </li>
                        {% endif %}
                        <!-- Current Page -->
                        <li class="text-red-600 font-semibold">{{ self.title }}</li>
                    </ul>
                </nav>
                {% endif %}
            </div>


            <!-- Title Section -->
            <h1 class="sendeplan-heading"> Sendeplan </h1>
            <h2 class="text-base font-semibold text-[#511120] mb-3 mt-3 ml-2 text-xl"> Radio Nova sender programmer
                hverdager 06:00 til 00:00, og helger 09:00 til 00:00. </h2>
        </div>
    </header>


    <div class="desktop-sendeplan mb-2">
        <div class="bg-white p-6 md:p-8">

            <!-- TABS: bruker dine klassenavn + Tailwind for utseende -->
            <div class="frame-6 relative">
                <div class="flex gap-3">
                    <!-- Aktiv tab (component-2) -->
                    <div
                        class="component-2 inline-flex items-center rounded-sm border-2 border-[#4B0C1B] text-white px-4 py-2">
                        <!-- Bruk gjerne SVG-ikonet ditt her -->
                        <svg class="w-5 h-5 mr-2 color_logo text-white" viewBox="0 0 20 20" fill="none">
                            <rect x="3" y="4" width="14" height="12" rx="2" stroke="currentColor" stroke-width="1.7" />
                            <line x1="6" y1="7" x2="14" y2="7" stroke="currentColor" stroke-width="1.7"
                                stroke-linecap="round" />
                            <line x1="6" y1="10" x2="12" y2="10" stroke="currentColor" stroke-width="1.7"
                                stroke-linecap="round" />
                            <line x1="6" y1="13" x2="10" y2="13" stroke="currentColor" stroke-width="1.7"
                                stroke-linecap="round" />
                        </svg>

                        <!-- beholder dine wrappers -->

                        <div class="text-wrapper-6">Vis som dagsliste</div>
                    </div>

                    <!-- Inaktiv tab (component-4) -->
                    <div
                        class="component-4 inline-flex items-center rounded-md border-2 border-[#4B0C1B] bg-[#EBDDE1] text-[#4B0C1B] px-4 py-2">
                        <svg class="w-5 h-5 mr-2 color_logo text-[#4B0C1B]" viewBox="0 0 20 20" fill="none">
                            <rect x="3" y="3" width="3" height="14" rx="1" stroke="currentColor" stroke-width="1.7" />
                            <rect x="8.5" y="3" width="3" height="14" rx="1" stroke="currentColor" stroke-width="1.7" />
                            <rect x="14" y="3" width="3" height="14" rx="1" stroke="currentColor" stroke-width="1.7" />
                        </svg>

                        <div class="component-3 hidden">
                            <div class="rectangle-4"></div>
                            <div class="rectangle-5"></div>
                            <div class="rectangle-6"></div>
                        </div>
                        <div class="text-wrapper-4">Vis som ukesoversikt</div>
                    </div>
                </div>

                <!-- underline under tabs -->
                <div class="absolute bottom-0 right-100 -translate-x-20 w-[1200px] h-[2px] bg-[#4B0C1B]"></div>

            </div>

            <!-- UKE-DAGER: bruker dine containere + Tailwind for “pills” -->
            <div class="frame-9 mt-10">
                <div class="frame-2">
                    <div class="frame-10 flex flex-wrap gap-4">
                        <div class="component-5 inline-block px-5 py-2 rounded-md border-2 border-[#4B0C1B] bg-[#F2E7EB] text-[#4B0C1B]"
                            id="mandag">
                            <div class="text-wrapper-4">Mandag</div>
                        </div>
                        <div class="component-6 inline-block px-5 py-2 rounded-md border-2 border-[#4B0C1B] bg-[#F2E7EB] text-[#4B0C1B]"
                            id="tirsdag">
                            <div class="text-wrapper-4">Tirsdag</div>
                        </div>
                        <div class="component-6 inline-block px-5 py-2 rounded-md border-2 border-[#4B0C1B] bg-[#F2E7EB] text-[#4B0C1B]"
                            id="onsdag">
                            <div class="text-wrapper-4">Onsdag</div>
                        </div>
                        <div class="component-6 inline-block px-5 py-2 rounded-md border-2 border-[#4B0C1B] bg-[#F2E7EB] text-[#4B0C1B]"
                            id="torsdag">
                            <div class="text-wrapper-4">Torsdag</div>
                        </div>
                        <div class="component-6 inline-block px-5 py-2 rounded-md border-2 border-[#4B0C1B] bg-[#F2E7EB] text-[#4B0C1B]"
                            id="fredag">
                            <div class="text-wrapper-4">Fredag</div>
                        </div>
                        <div class="component-6 inline-block px-5 py-2 rounded-md border-2 border-[#4B0C1B] bg-[#F2E7EB] text-[#4B0C1B]"
                            id="lordag">
                            <div class="text-wrapper-4">Lørdag</div>
                        </div>
                        <div class="component-6 inline-block px-5 py-2 rounded-md border-2 border-[#4B0C1B] bg-[#F2E7EB] text-[#4B0C1B]"
                            id="sondag">
                            <div class="text-wrapper-4">Søndag</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <div class="frame-11">
            <div class="Mandager">
                <div class="frame-12">
                    <div class="frame-13">
                        {% for program in sendeplan.1 %}
                        <div class="frame-14">
                            <div class="frame-18">

                                {% if program.main_image %}
                                {% image program.main_image fill-400x400 class="image" %}
                                {% endif %}

                                <div class="frame-15">
                                    <div class="frame-16">
                                        <div class="frame-17">
                                            <div class="frame-14">
                                                <div class="text-wrapper-4">
                                                    {{ program.start_time }} - {{ program.end_time }}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="frame-3">
                                            <div class="frame-17">
                                                <div class="text-wrapper-7">{{ program.title }}</div>
                                            </div>
                                            <div class="component-7">
                                                <div class="text-wrapper-8">{{ program.category }}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="text-wrapper-9">{{ program.intro }}</div>
                                </div>

                                {% if program.is_live_now %}
                                <div class="overlap-group-wrapper">
                                    <div class="overlap-group">
                                        <div class="rectangle-7"></div>
                                        <div class="text-wrapper-10">NÅ</div>
                                    </div>
                                </div>
                                {% endif %}

                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="Tirsdager">
                <div class="frame-12">
                    <div class="frame-13">
                        {% for program in sendeplan.2 %}
                        <div class="frame-14">
                            <div class="frame-18">

                                {% if program.main_image %}
                                {% image program.main_image fill-400x400 class="image" %}
                                {% endif %}

                                <div class="frame-15">
                                    <div class="frame-16">
                                        <div class="frame-17">
                                            <div class="frame-14">
                                                <div class="text-wrapper-4">
                                                    {{ program.start_time }} - {{ program.end_time }}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="frame-3">
                                            <div class="frame-17">
                                                <div class="text-wrapper-7">{{ program.title }}</div>
                                            </div>
                                            <div class="component-7">
                                                <div class="text-wrapper-8">{{ program.category }}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="text-wrapper-9">{{ program.intro }}</div>
                                </div>

                                {% if program.is_live_now %}
                                <div class="overlap-group-wrapper">
                                    <div class="overlap-group">
                                        <div class="rectangle-7"></div>
                                        <div class="text-wrapper-10">NÅ</div>
                                    </div>
                                </div>
                                {% endif %}

                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="Onsdager">
                <div class="frame-12">
                    <div class="frame-13">
                        {% for program in sendeplan.3 %}
                        <div class="frame-14">
                            <div class="frame-18">

                                {% if program.main_image %}
                                {% image program.main_image fill-400x400 class="image" %}
                                {% endif %}

                                <div class="frame-15">
                                    <div class="frame-16">
                                        <div class="frame-17">
                                            <div class="frame-14">
                                                <div class="text-wrapper-4">
                                                    {{ program.start_time }} - {{ program.end_time }}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="frame-3">
                                            <div class="frame-17">
                                                <div class="text-wrapper-7">{{ program.title }}</div>
                                            </div>
                                            <div class="component-7">
                                                <div class="text-wrapper-8">{{ program.category }}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="text-wrapper-9">{{ program.intro }}</div>
                                </div>

                                {% if program.is_live_now %}
                                <div class="overlap-group-wrapper">
                                    <div class="overlap-group">
                                        <div class="rectangle-7"></div>
                                        <div class="text-wrapper-10">NÅ</div>
                                    </div>
                                </div>
                                {% endif %}

                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="Torsdager">
                <div class="frame-12">
                    <div class="frame-13">
                        {% for program in sendeplan.4 %}
                        <div class="frame-14">
                            <div class="frame-18">

                                {% if program.main_image %}
                                {% image program.main_image fill-400x400 class="image" %}
                                {% endif %}

                                <div class="frame-15">
                                    <div class="frame-16">
                                        <div class="frame-17">
                                            <div class="frame-14">
                                                <div class="text-wrapper-4">
                                                    {{ program.start_time }} - {{ program.end_time }}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="frame-3">
                                            <div class="frame-17">
                                                <div class="text-wrapper-7">{{ program.title }}</div>
                                            </div>
                                            <div class="component-7">
                                                <div class="text-wrapper-8">{{ program.category }}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="text-wrapper-9">{{ program.intro }}</div>
                                </div>

                                {% if program.is_live_now %}
                                <div class="overlap-group-wrapper">
                                    <div class="overlap-group">
                                        <div class="rectangle-7"></div>
                                        <div class="text-wrapper-10">NÅ</div>
                                    </div>
                                </div>
                                {% endif %}

                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="Fredager">
                <div class="frame-12">
                    <div class="frame-13">
                        {% for program in sendeplan.5 %}
                        <div class="frame-14">
                            <div class="frame-18">

                                {% if program.main_image %}
                                {% image program.main_image fill-400x400 class="image" %}
                                {% endif %}

                                <div class="frame-15">
                                    <div class="frame-16">
                                        <div class="frame-17">
                                            <div class="frame-14">
                                                <div class="text-wrapper-4">
                                                    {{ program.start_time }} - {{ program.end_time }}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="frame-3">
                                            <div class="frame-17">
                                                <div class="text-wrapper-7">{{ program.title }}</div>
                                            </div>
                                            <div class="component-7">
                                                <div class="text-wrapper-8">{{ program.category }}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="text-wrapper-9">{{ program.intro }}</div>
                                </div>

                                {% if program.is_live_now %}
                                <div class="overlap-group-wrapper">
                                    <div class="overlap-group">
                                        <div class="rectangle-7"></div>
                                        <div class="text-wrapper-10">NÅ</div>
                                    </div>
                                </div>
                                {% endif %}

                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>

            <div class="Lordager">
                <div class="frame-12">
                    <div class="frame-13">
                        {% for program in sendeplan.6 %}
                        <div class="frame-14">
                            <div class="frame-18">

                                {% if program.main_image %}
                                {% image program.main_image fill-400x400 class="image" %}
                                {% endif %}

                                <div class="frame-15">
                                    <div class="frame-16">
                                        <div class="frame-17">
                                            <div class="frame-14">
                                                <div class="text-wrapper-4">
                                                    {{ program.start_time }} - {{ program.end_time }}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="frame-3">
                                            <div class="frame-17">
                                                <div class="text-wrapper-7">{{ program.title }}</div>
                                            </div>
                                            <div class="component-7">
                                                <div class="text-wrapper-8">{{ program.category }}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="text-wrapper-9">{{ program.intro }}</div>
                                </div>

                                {% if program.is_live_now %}
                                <div class="overlap-group-wrapper">
                                    <div class="overlap-group">
                                        <div class="rectangle-7"></div>
                                        <div class="text-wrapper-10">NÅ</div>
                                    </div>
                                </div>
                                {% endif %}

                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            <div class="Sondager">
                <div class="frame-12">
                    <div class="frame-13">
                        {% for program in sendeplan.7 %}
                        <div class="frame-14">
                            <div class="frame-18">

                                {% if program.main_image %}
                                {% image program.main_image fill-400x400 class="image" %}
                                {% endif %}

                                <div class="frame-15">
                                    <div class="frame-16">
                                        <div class="frame-17">
                                            <div class="frame-14">
                                                <div class="text-wrapper-4">
                                                    {{ program.start_time }} - {{ program.end_time }}
                                                </div>
                                            </div>
                                        </div>

                                        <div class="frame-3">
                                            <div class="frame-17">
                                                <div class="text-wrapper-7">{{ program.title }}</div>
                                            </div>
                                            <div class="component-7">
                                                <div class="text-wrapper-8">{{ program.category }}</div>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="text-wrapper-9">{{ program.intro }}</div>
                                </div>

                                {% if program.is_live_now %}
                                <div class="overlap-group-wrapper">
                                    <div class="overlap-group">
                                        <div class="rectangle-7"></div>
                                        <div class="text-wrapper-10">NÅ</div>
                                    </div>
                                </div>
                                {% endif %}

                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>





        </div>
    </div>
    <!-- Toggle html code when vis som uke oversikt er clicked-->
    <div class="schedule-shell frame-123">
        <!-- Top red scrollbar -->
        <div class="scrollbar-top" id="hBar">
            <div class="spacer" id="hSpace"></div>
        </div>

        <!-- Content wrapper (the only scroller for the iframe) -->
         
        <div class="content-wrap" id="wrap">
             <div class="schedule-content-wrapper" style="min-width: 1200px;">
           <div class="max-w-10xl mx-auto">
    <div class="bg-white rounded-lg shadow-lg overflow-hidden">
        <div class="flex">
            <!-- Time Column  -->
            <div class="time-table">
                <table class="border-collapse">
                    <thead>
                        <tr class="bg-gray-100">
                            <th class="border border-gray-300 p-2 text-left font-semibold w-16">Tid</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for time in time_slots %}
                        <tr class="{% if forloop.counter0|divisibleby:2 %}bg-white{% endif %}">
                            <td class="border border-gray-300 time-cell">{{ time }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>

            <!-- Schedule Content -->
            <div class="schedule-container overflow-x-auto flex-1">
                <table class="border-collapse min-w-max">
                    <thead>
                        <tr class="bg-gray-100">
                            {% for day_name in day_names %}
                            <th class="border border-gray-300 p-2 text-center font-semibold min-w-32">
                                {{ day_name }}
                            </th>
                            {% endfor %}
                        </tr>
                    </thead>
                    <tbody>
                        {% for time in time_slots %}
                        <tr class="{% if forloop.counter0|divisibleby:2 %}bg-white{% endif %}">
                            {% for day_index in weekdays %}
                                {% with day_programs=sendeplan|dict_get:day_index %}
                                {% with program_found=False %}
                                
                                    <!-- Check if any program starts at this time for this day -->
                                    {% for program in day_programs %}
                                        {% if program.start_time == time and not program_found %}
                                            <td class="border border-gray-300 schedule-cell 
                                                {% if not forloop.parentloop.parentloop.counter0|divisibleby:2 %}
                                                    {% if forloop.parentloop.counter0|divisibleby:2 %}bg-green-100{% else %}bg-yellow-100{% endif %}
                                                {% else %}
                                                    bg-white
                                                {% endif %}"
                                                rowspan="{{ program.rowspan }}">
                                                <strong>{{ program.title }}</strong><br>
                                                <span class="text-xs">{{ program.start_time }} - {{ program.end_time }}</span>
                                            </td>
                                            {% with program_found=True %}{% endwith %}
                                        {% endif %}
                                    {% endfor %}
                                    
                                    <!-- Check if this time slot is covered by a program that started earlier -->
                                    {% if not program_found %}
                                        {% for program in day_programs %}
                                            {% if program.start_time < time and program.end_time > time %}
                                                {% with program_found=True %}{% endwith %}
                                            {% endif %}
                                        {% endfor %}
                                    {% endif %}
                                    
                                    <!-- If no program found and not covered by rowspan, render placeholder -->
                                    {% if not program_found %}
                                        <td class="border border-gray-300 schedule-cell 
                                            {% if not forloop.parentloop.counter0|divisibleby:2 %}
                                                {% if forloop.counter0|divisibleby:2 %}bg-green-100{% else %}bg-yellow-100{% endif %}
                                            {% else %}
                                                bg-white
                                            {% endif %}">
                                            -
                                        </td>
                                    {% endif %}
                                    
                                {% endwith %}
                                {% endwith %}
                            {% endfor %}
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

        </div>


        <!-- Right red scrollbar -->
        <div class="scrollbar-right" id="vBar">
            <div class="spacer-vert" id="vSpace"></div>
        </div>
    </div>
    </div>

</body>

{% endblock %}

{% block extra_js %}
{{ block.super }}
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
<script src="{% static 'tears/js/sendeplan.js' %}?v={% now 'U' %}" defer></script>
<script src="{% static 'tears/js/naavaerendeprogram.js' %}"></script>
{% endblock %}